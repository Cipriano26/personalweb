<!-- src/app/cv/cv.component.html -->
<div class="min-h-screen text-gray-900 dark:text-gray-100">
  <!-- Header -->
  <header class="w-full border-b border-gray-200 dark:border-gray-800">
    <div class="mx-auto max-w-6xl px-4 py-6 flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-semibold"><a href="/">Cipriano Gorosito</a></h1>
        <p class="text-sm text-gray-500 dark:text-gray-400">Web developer</p>
      </div>
      <nav class="flex items-center gap-4 text-xl print:hidden">
        <a class="hover:opacity-80 transition" href="#" (click)="exportPdf($event)" title="Descargar PDF" aria-label="Descargar PDF">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
        </a>
        <a class="hover:opacity-80 transition" href="https://github.com/Cipriano26" target="_blank" rel="noreferrer">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github-icon lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
        </a>
        <a class="hover:opacity-80 transition" href="https://twitter.com/ciprrriano" target="_blank" rel="noreferrer">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-twitter-icon lucide-twitter"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"/></svg>
        </a>
        <a class="hover:opacity-80 transition" href="https://web.whatsapp.com/send/?phone=541128173122&text=Hola+Cipriano%21" target="_blank" rel="noreferrer">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle-more-icon lucide-message-circle-more"><path d="M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719"/><path d="M8 12h.01"/><path d="M12 12h.01"/><path d="M16 12h.01"/></svg>
        </a>
        <a class="hover:opacity-80 transition" href="https://www.instagram.com/ciprianogn/" target="_blank" rel="noreferrer">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-instagram-icon lucide-instagram"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg>
        </a>
        <a class="hover:opacity-80 transition" href="mailto:nahuelgorosito1983@gmail.com">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail-icon lucide-mail"><path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"/><rect x="2" y="4" width="20" height="16" rx="2"/></svg>
        </a>
      </nav>
    </div>
  </header>

  <!-- Loading / Error -->
  <div *ngIf="loading()" class="mx-auto max-w-6xl px-4 py-10">
    <div class="animate-pulse h-6 w-48 bg-gray-200 dark:bg-gray-800 rounded mb-4"></div>
    <div class="animate-pulse h-4 w-full bg-gray-200 dark:bg-gray-800 rounded"></div>
  </div>
  <div *ngIf="error()" class="mx-auto max-w-6xl px-4 py-6">
    <div class="rounded-lg border border-red-300 bg-red-50 text-red-800 dark:border-red-800 dark:bg-red-900/30 p-4">
      {{ error() }}
    </div>
  </div>

  <main *ngIf="!loading() && !error()" id="cv-print" class="mx-auto max-w-6xl px-4 py-10 space-y-12">
    <!-- About -->
    <section id="about" class="space-y-4">
      <h4 class="text-lg font-semibold">{{ greeting }}</h4>
      <p class="text-gray-600 dark:text-gray-300">
        Me llamo Cipriano, programador web. Desde mis inicios con una computadora, me sumergí en el hermoso
        universo de Internet, llevándome a emprender y crear proyectos digitales. Te invito a descubrir cómo mi
        pasión por la programación y mi perseverancia me moldean en mi camino hacia el éxito.
      </p>
    </section>

    <!-- Skills -->
    <section id="skills" class="space-y-4">
      <h4 class="text-lg font-semibold">Conocimientos</h4>

      <ng-container *ngFor="let group of groupedSkills(); trackBy: trackByIndex">
        <h3 class="mt-6 text-base font-semibold" *ngIf="hasVisibleSkills(group[1])">{{ group[0] }}</h3>

        <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-6" *ngIf="hasVisibleSkills(group[1])">
          <div *ngFor="let s of visibleSkills(group[1]); trackBy: trackById"
               class="group flex flex-col shadow-sm hover:shadow-md transition">
            <div class="">
              <div class="flex gap-x-4">
                <div class="mt-1 shrink-0 flex items-center justify-center w-9 h-9 rounded-md bg-gray-100 dark:bg-black">
                  <img class="max-h-5 opacity-80"
                       [src]="'assets/img/cards/' + (s.type || s.skill) + '.png'"
                       [alt]="s.type || s.skill">
                </div>

                <div class="grow">
                  <h3 class="font-semibold text-gray-800 dark:text-neutral-200 group-hover:text-blue-600 dark:group-hover:text-neutral-400">
                    {{ s.type || s.skill }}
                  </h3>
                  <p class="text-sm text-gray-500 dark:text-neutral-500" *ngIf="(s.type || '') !== (s.skill || '')">
                    {{ s.skill }}
                  </p>
                </div>
              </div>

              <div class="mt-2 text-right" *ngIf="s.description">
                <i class="bi" [ngClass]="(s.description || '').replace('icon: ', 'bi-') + ' text-base opacity-70'"></i>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </section>

    <!-- Abilities -->
    <section id="hability" class="space-y-4">
      <h4 class="text-lg font-semibold">Habilidades</h4>

      <div class="space-y-6">
        <div *ngFor="let g of data().abilitiesBySkill; trackBy: trackByIndex"
             class="">
          <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-800">
            <span class="text-sm font-semibold">{{ g.skillName }}</span>
          </div>

          <div class="p-4">
            <div class="space-y-3">
              <dl class="flex flex-col sm:flex-row gap-1"
                  *ngFor="let ab of g.groups; trackBy: trackByIndex">
                <dt class="min-w-80">
                  <span class="block text-sm text-gray-500 dark:text-neutral-500">{{ ab.abilityName }}:</span>
                </dt>
                <dd>
                  <ul>
                    <li *ngFor="let item of ab.items; trackBy: trackById"
                        class="me-1 after:content-[','] inline-flex items-center text-sm text-gray-800 dark:text-neutral-200">
                      {{ item.description }}
                    </li>
                  </ul>
                </dd>
              </dl>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- Studies -->
    <section id="studies" class="space-y-4">
      <h4 class="text-lg font-semibold">Estudios</h4>

      <!-- Timeline -->
      <div class="w-full mx-auto">
        <div>
          <!-- Item -->
          <div class="group relative flex gap-x-5" *ngFor="let st of data().studies; trackBy: trackById">
            <!-- Icon (image small and semi-rounded) -->
            <div class="relative group-last:after:hidden after:absolute after:top-8 after:bottom-2 after:start-3 after:w-px after:-translate-x-[0.5px] after:bg-gray-200 dark:after:bg-neutral-700">
              <div class="relative z-10 size-8 sm:size-10 flex justify-center items-center">
                <img
                  class="shrink-0 size-6 rounded-md object-contain bg-white ring-1 ring-gray-200 dark:ring-neutral-700 p-0.5"
                  [src]="'assets/img/cards/' + st.place + '.png'"
                  [alt]="'Logo de ' + st.place" />
              </div>
            </div>
            <!-- End Icon -->

            <!-- Right Content -->
            <div class="grow pb-8 group-last:pb-0">
              <h3 class="mb-1 text-xs text-gray-600 dark:text-neutral-400">
                {{ st.start_date | date:'MMMM y':'UTC' }}
              </h3>

              <p class="font-semibold text-sm text-gray-800 dark:text-neutral-200">
                {{ st.study }}
              </p>

              <p class="mt-1 text-sm text-gray-600 dark:text-neutral-400">
                {{ st.place }}
              </p>

              <p class="mt-2 text-sm text-gray-600 dark:text-neutral-400" *ngIf="st.description">
                {{ st.description }}
              </p>
            </div>
            <!-- End Right Content -->
          </div>
          <!-- End Item -->
        </div>
      </div>
      <!-- End Timeline -->
    </section>

    <!-- Works -->
    <section id="works" class="space-y-4">
      <h4 class="text-lg font-semibold">Trabajos</h4>
      <ng-container *ngIf="data().works.length > 0; else noWorks">
        <!-- Approach: bloque para el único trabajo actual -->
        <div class="dark:bg-neutral-900 rounded-2xl overflow-hidden">
          <div class="xl:px-0 lg:pb-20 mx-auto">
            <!-- Title -->
            <ng-container *ngFor="let wk of (data().works | slice:0:1); trackBy: trackById">
              <!-- Título + Imagen en línea (siempre en fila) -->
              <div class="flex flex-row items-stretch gap-6 mb-8 lg:mb-12">
                <div class="self-stretch shrink-0 w-auto" style="aspect-ratio: 1 / 1; height: 80px; max-width: 80px;">
                  <img class="w-full h-full object-cover rounded-xl" src="assets/img/cards/via.png" alt="{{ wk.company }}">
                </div>
                <div class="flex-1 max-w-3xl min-w-0">
                  <h2 class="dark:text-white font-semibold text-2xl md:text-4xl md:leading-tight">
                    {{ wk.company }}
                  </h2>
                  <p class="mt-1 text-neutral-400">
                    {{ wk.category }} · {{ wk.start_date | date:'MMMM y':'UTC' }} — {{ (wk.end_date | date:'MMMM y':'UTC') || 'Actualidad' }}
                  </p>
                </div>
              </div>

              <!-- Tareas en horizontal -->
              <div>
                <!-- Heading -->
                <div class="mb-3">
                  <h3 class="dark:text-neutral-400 text-xs font-medium uppercase">Tareas</h3>
                </div>
                <!-- End Heading -->

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 lg:gap-4 items-start">
                  <div *ngFor="let t of tasksByWorkId(wk.id); let i = index; trackBy: trackById" class="flex items-start gap-2">
                    <span class="inline-flex shrink-0 justify-center items-center size-6 border border-neutral-800 dark:text-neutral-400 font-semibold text-[10px] rounded-full">
                      {{ i + 1 }}
                    </span>
                    <p class="text-sm text-neutral-400">
                      <span class="text-black dark:text-white">{{ t.task }}:</span>
                      {{ t.description }}
                    </p>
                  </div>
                </div>

                <a class="mt-6 inline-flex items-center group inline-flex items-center gap-x-2 py-2 px-3 bg-gray-200 dark:bg-black font-medium text-sm text-neutral-800 rounded-full focus:outline-hidden"
                   routerLink="/contact">
                  <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path><path class="opacity-0 group-hover:opacity-100 group-focus:opacity-100 group-hover:delay-100 transition" d="M14.05 2a9 9 0 0 1 8 7.94"></path><path class="opacity-0 group-hover:opacity-100 group-focus:opacity-100 transition" d="M14.05 6A5 5 0 0 1 18 10"></path></svg>
                  Telefono de referencia
                </a>
              </div>
            </ng-container>
            <!-- End Title + Grid -->
          </div>
        </div>
      </ng-container>
      <ng-template #noWorks>
        <p class="text-sm text-gray-600 dark:text-neutral-400">Sin trabajos para mostrar por el momento.</p>
      </ng-template>
    </section>
  </main>
</div>
